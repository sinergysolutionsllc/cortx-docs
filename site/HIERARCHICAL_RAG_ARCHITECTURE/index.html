
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>CORTX Hierarchical RAG Architecture - CORTX by Sinergy</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cortx-hierarchical-rag-architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CORTX by Sinergy" class="md-header__button md-logo" aria-label="CORTX by Sinergy" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CORTX by Sinergy
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CORTX Hierarchical RAG Architecture
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CORTX by Sinergy" class="md-nav__button md-logo" aria-label="CORTX by Sinergy" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CORTX by Sinergy
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Platform Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gateway
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Gateway
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gateway (8080)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/gateway/openapi.yaml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (YAML)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/gateway/openapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (Redoc)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Identity
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Identity
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/identity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identity (8082)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/identity/openapi.yaml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (YAML)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/identity/openapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (Redoc)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Validation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation (8083)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/validation/openapi.yaml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (YAML)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/validation/openapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (Redoc)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AI Broker
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            AI Broker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/ai-broker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AI Broker (8085)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/ai-broker/openapi.yaml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (YAML)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/ai-broker/openapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (Redoc)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Workflow
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workflow (8130)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/workflow/openapi.yaml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (YAML)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/workflow/openapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (Redoc)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Compliance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Compliance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compliance (8135)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/compliance/openapi.yaml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (YAML)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/compliance/openapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (Redoc)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ledger
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Ledger
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/ledger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ledger (8136)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/ledger/openapi.yaml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (YAML)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/ledger/openapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (Redoc)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    OCR
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            OCR
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/ocr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OCR (8137)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/ocr/openapi.yaml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (YAML)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/ocr/openapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (Redoc)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    RAG
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            RAG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RAG (8138)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/rag/openapi.yaml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (YAML)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/rag/openapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI (Redoc)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../suites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Suites
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../packs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Packs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sdks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SDKs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contribute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../adrs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADRs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rfcs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RFCs
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Executive Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Executive Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-design-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Key Design Principles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-hierarchical-knowledge-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      1. Hierarchical Knowledge Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Hierarchical Knowledge Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#12-platform-integration-svc-rag-svc-ocr-svc-ledger" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Platform Integration (svc-rag, svc-ocr, svc-ledger)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-four-level-knowledge-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Four-Level Knowledge Hierarchy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-contextual-retrieval-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      2. Contextual Retrieval Strategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Contextual Retrieval Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-cascading-context-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Cascading Context Pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-context-priority-scoring" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Context Priority Scoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-smart-context-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Smart Context Expansion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-vector-store-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      3. Vector Store Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Vector Store Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-database-schema-design" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 Database Schema Design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-vector-search-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 Vector Search Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-rag-management-ui-from-fedtransform" class="md-nav__link">
    <span class="md-ellipsis">
      4. RAG Management UI (From FedTransform)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. RAG Management UI (From FedTransform)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-capabilities-to-extract" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Capabilities to Extract
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-new-rag-management-service" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 New RAG Management Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-ui-mockup" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 UI Mockup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-ocr-service-port-8137" class="md-nav__link">
    <span class="md-ellipsis">
      5. OCR Service (Port 8137)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. OCR Service (Port 8137)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-service-purpose" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 Service Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-data-linking-from-propverify" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 Data Linking (From PropVerify)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-ledger-service-port-8136" class="md-nav__link">
    <span class="md-ellipsis">
      6. Ledger Service (Port 8136)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Ledger Service (Port 8136)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-service-purpose" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 Service Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-database-schema" class="md-nav__link">
    <span class="md-ellipsis">
      6.3 Database Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-implementation-roadmap" class="md-nav__link">
    <span class="md-ellipsis">
      7. Implementation Roadmap
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Implementation Roadmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-foundation-weeks-1-2" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1: Foundation (Weeks 1-2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-ocr-ledger-services-weeks-3-4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2: OCR &amp; Ledger Services (Weeks 3-4)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-hierarchical-retrieval-weeks-5-6" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 3: Hierarchical Retrieval (Weeks 5-6)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-rag-management-ui-weeks-7-8" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 4: RAG Management UI (Weeks 7-8)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-integration-testing-weeks-9-10" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 5: Integration &amp; Testing (Weeks 9-10)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-migration-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      8. Migration Strategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Migration Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-existing-rag-data" class="md-nav__link">
    <span class="md-ellipsis">
      8.1 Existing RAG Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-knowledge-seeding" class="md-nav__link">
    <span class="md-ellipsis">
      8.2 Knowledge Seeding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-open-questions-decisions" class="md-nav__link">
    <span class="md-ellipsis">
      9. Open Questions &amp; Decisions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Open Questions &amp; Decisions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-embedding-model" class="md-nav__link">
    <span class="md-ellipsis">
      9.1 Embedding Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-chunking-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      9.2 Chunking Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-vector-store-performance" class="md-nav__link">
    <span class="md-ellipsis">
      9.3 Vector Store Performance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-environment-deployment-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      10. Environment &amp; Deployment Considerations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cortx-hierarchical-rag-architecture">CORTX Hierarchical RAG Architecture</h1>
<p><strong>Date:</strong> 2025-10-01
<strong>Status:</strong> Strategic Design
<strong>Team:</strong> Tech Architect Analysis</p>
<hr />
<h2 id="executive-summary">Executive Summary</h2>
<p>This document defines a <strong>4-level hierarchical RAG (Retrieval-Augmented Generation) architecture</strong> for the CORTX Platform, enabling contextual AI assistance that understands knowledge at Platform, Suite, Module, and Entity levels.</p>
<h3 id="key-design-principles">Key Design Principles</h3>
<ol>
<li><strong>Contextual Awareness</strong>: AI can access knowledge from all relevant levels</li>
<li><strong>Hierarchical Retrieval</strong>: Search starts narrow (Module) and expands outward (Suite → Platform)</li>
<li><strong>Scoped Permissions</strong>: Entity-level knowledge is tenant-isolated</li>
<li><strong>Unified Management</strong>: Single RAG Management UI for ingesting and organizing knowledge</li>
<li><strong>Platform Integration</strong>: Centralized <strong>svc-rag (8138)</strong> with ingestion from <strong>svc-ocr (8137)</strong> and provenance via <strong>svc-ledger (8136)</strong></li>
</ol>
<hr />
<h2 id="1-hierarchical-knowledge-architecture">1. Hierarchical Knowledge Architecture</h2>
<h3 id="12-platform-integration-svc-rag-svc-ocr-svc-ledger">1.2 Platform Integration (svc-rag, svc-ocr, svc-ledger)</h3>
<ul>
<li><strong>svc-rag (8138):</strong> Central RAG APIs for ingest → chunk → embed → retrieve across four scopes (Platform, Suite, Module, Entity). Exposes Admin UI hooks used by Designer.</li>
<li><strong>svc-ocr (8137):</strong> Document → text/fields extraction; normalized <code>DocumentExtraction</code> JSON is ingested by svc-rag with appropriate scope metadata.</li>
<li><strong>svc-ledger (8136):</strong> Append-only, SHA-256 hash-chained evidence for all compliance-relevant RAG actions (ingest, delete, query served to end users), enabling end-to-end provenance.</li>
</ul>
<h3 id="11-four-level-knowledge-hierarchy">1.1 Four-Level Knowledge Hierarchy</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                    LEVEL 1: PLATFORM                            │
│  Universal knowledge applicable to ALL suites &amp; modules         │
│  ├── NIST 800-53, FedRAMP, HIPAA, SOC 2 controls               │
│  ├── CORTX Platform documentation                               │
│  ├── General AI/ML best practices                               │
│  ├── Security &amp; compliance frameworks                           │
│  └── Cross-industry standards                                   │
│  Scope: Global | Permissions: Public                            │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    LEVEL 2: SUITE                               │
│  Domain-specific knowledge for a vertical                       │
│                                                                 │
│  FedSuite:                                                      │
│  ├── OMB Circulars (A-11, A-123, A-136)                        │
│  ├── Treasury GTAS Reporting Guide                             │
│  ├── Federal accounting standards (USSGL, FASAB)               │
│  └── Agency-wide policies (DOD FMR, VA directives)             │
│                                                                 │
│  CorpSuite:                                                     │
│  ├── Real estate law (Maryland, Virginia)                      │
│  ├── Procurement regulations (FAR, state rules)                │
│  └── Corporate compliance (SOX, GAAP)                          │
│                                                                 │
│  MedSuite:                                                      │
│  ├── HIPAA Privacy &amp; Security Rules                            │
│  ├── CMS guidelines                                             │
│  └── Healthcare billing standards (ICD-10, CPT)                │
│                                                                 │
│  Scope: Suite-wide | Permissions: Suite users                  │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    LEVEL 3: MODULE                              │
│  Module-specific technical knowledge                            │
│                                                                 │
│  FedTransform:                                                  │
│  ├── Oracle EBS table schemas (GL, AP, AR, FA)                 │
│  ├── PeopleSoft FSCM structure                                 │
│  ├── SAP ECC/S4 HANA data models                               │
│  ├── Workday Financial mappings                                │
│  └── FBDI template specifications                              │
│                                                                 │
│  PropVerify:                                                    │
│  ├── Maryland SDAT API documentation                           │
│  ├── MDLandRec data dictionary                                 │
│  ├── Title examination checklists                              │
│  └── Lien/encumbrance lookup procedures                        │
│                                                                 │
│  FedReconcile:                                                  │
│  ├── GTAS submission schemas (ATB, BETC)                       │
│  ├── Trial Balance validation rules (204+ rules)               │
│  └── Reconciliation workflows                                  │
│                                                                 │
│  Scope: Module-wide | Permissions: Module users                │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    LEVEL 4: ENTITY (Tenant)                     │
│  Organization/tenant-specific knowledge                         │
│                                                                 │
│  Examples:                                                      │
│  ├── Agency-specific accounting policies                        │
│  ├── Department-specific approval workflows                     │
│  ├── Custom chart of accounts mappings                         │
│  ├── Organization-specific compliance interpretations          │
│  └── Internal standard operating procedures (SOPs)             │
│                                                                 │
│  Scope: Tenant-specific | Permissions: Tenant users only       │
│  Security: RLS enforced, encrypted at rest                     │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<hr />
<h2 id="2-contextual-retrieval-strategy">2. Contextual Retrieval Strategy</h2>
<h3 id="21-cascading-context-pattern">2.1 Cascading Context Pattern</h3>
<p><strong>Scenario:</strong> User working in FedTransform asks: <em>"How do I map Oracle GL balances to GTAS?"</em></p>
<p><strong>Retrieval flow:</strong></p>
<pre><code>1. MODULE (FedTransform):
   ├── Search: Oracle EBS GL tables, FBDI mappings
   └── Retrieve: Top 5 chunks (score &gt; 0.7)

2. SUITE (FedSuite):
   ├── Search: GTAS reporting requirements, USSGL mapping rules
   └── Retrieve: Top 5 chunks (score &gt; 0.7)

3. ENTITY (Tenant: DOD Finance):
   ├── Search: DOD-specific GL to GTAS mappings, agency policies
   └── Retrieve: Top 3 chunks (score &gt; 0.8)

4. PLATFORM (if needed):
   ├── Search: Data transformation best practices
   └── Retrieve: Top 2 chunks (score &gt; 0.75)

5. COMBINE CONTEXT:
   ├── Module: 5 chunks (most specific)
   ├── Suite: 5 chunks (domain rules)
   ├── Entity: 3 chunks (org-specific)
   ├── Platform: 2 chunks (general guidance)
   └── Total: 15 chunks passed to LLM
</code></pre>
<h3 id="22-context-priority-scoring">2.2 Context Priority Scoring</h3>
<pre><code class="language-python">def calculate_context_score(chunk, level, base_similarity_score):
    &quot;&quot;&quot;
    Boost scores based on hierarchical relevance
    &quot;&quot;&quot;
    level_boost = {
        &quot;entity&quot;: 0.15,    # Most specific to user's org
        &quot;module&quot;: 0.10,    # Most specific to current task
        &quot;suite&quot;: 0.05,     # Domain-relevant
        &quot;platform&quot;: 0.0    # Baseline
    }

    return base_similarity_score + level_boost[level]
</code></pre>
<h3 id="23-smart-context-expansion">2.3 Smart Context Expansion</h3>
<p><strong>When to expand to higher levels:</strong>
1. <strong>Insufficient results</strong> at lower level (&lt; 3 chunks above threshold)
2. <strong>Explicit cross-domain query</strong> (e.g., "What are the compliance requirements?")
3. <strong>User requests broader context</strong> (e.g., "Include federal regulations")</p>
<p><strong>When to restrict context:</strong>
1. <strong>Highly technical query</strong> (e.g., "What's the Oracle GL_BALANCES table structure?")
2. <strong>Entity-specific query</strong> (e.g., "What's our approval workflow?")
3. <strong>Performance optimization</strong> (fewer tokens = faster, cheaper)</p>
<hr />
<h2 id="3-vector-store-architecture">3. Vector Store Architecture</h2>
<h3 id="31-database-schema-design">3.1 Database Schema Design</h3>
<p><strong>PostgreSQL with pgvector extension:</strong></p>
<pre><code class="language-sql">-- Unified RAG schema using pgvector with level-based scoping
CREATE SCHEMA IF NOT EXISTS rag;

CREATE TABLE rag.documents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id TEXT NOT NULL,                -- 'global' for Platform
    level TEXT NOT NULL CHECK (level IN ('platform','suite','module','entity')),
    suite_id TEXT,                          -- nullable when not applicable
    module_id TEXT,                         -- nullable when not applicable
    title TEXT,
    source_type TEXT,                       -- upload|url|api
    source_uri TEXT,
    metadata JSONB DEFAULT '{}'::jsonb,
    ingested_at TIMESTAMPTZ DEFAULT now(),
    ingested_by TEXT,
    version TEXT,
    tags TEXT[]
);

CREATE TABLE rag.chunks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    document_id UUID NOT NULL REFERENCES rag.documents(id) ON DELETE CASCADE,
    ord INT NOT NULL,
    content TEXT NOT NULL,
    meta JSONB DEFAULT '{}'::jsonb,        -- page, section, headers
    embedding VECTOR(384)                  -- using 384-dim embeddings
);

-- Row-Level Security for tenant isolation on documents (applies to chunks via FK)
ALTER TABLE rag.documents ENABLE ROW LEVEL SECURITY;

CREATE POLICY rag_docs_tenant_isolation ON rag.documents
  USING (tenant_id = current_setting('app.current_tenant_id', true));

-- Similarity indexes
CREATE INDEX IF NOT EXISTS idx_chunks_embedding ON rag.chunks
  USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

-- Helpful metadata indexes
CREATE INDEX IF NOT EXISTS idx_docs_level ON rag.documents(level);
CREATE INDEX IF NOT EXISTS idx_docs_suite_module ON rag.documents(suite_id, module_id);
CREATE INDEX IF NOT EXISTS idx_docs_tenant ON rag.documents(tenant_id);
</code></pre>
<h3 id="32-vector-search-implementation">3.2 Vector Search Implementation</h3>
<pre><code class="language-python"># services/rag/app/hierarchical_retrieval.py
from typing import List, Dict, Any, Optional
import asyncpg

class HierarchicalRAGRetriever:
    &quot;&quot;&quot;
    Retrieve context from unified rag.documents/rag.chunks across levels.
    &quot;&quot;&quot;

    def __init__(self, db_pool: asyncpg.Pool):
        self.db = db_pool

    async def retrieve_context(
        self,
        query_embedding: List[float],
        tenant_id: str,
        suite_id: str,
        module_id: str,
        levels: List[str] = [&quot;entity&quot;, &quot;module&quot;, &quot;suite&quot;, &quot;platform&quot;],
        k_per_level: Optional[Dict[str, int]] = None,
        boosts: Optional[Dict[str, float]] = None
    ) -&gt; List[Dict[str, Any]]:
        if k_per_level is None:
            k_per_level = {&quot;entity&quot;: 3, &quot;module&quot;: 5, &quot;suite&quot;: 5, &quot;platform&quot;: 2}
        if boosts is None:
            boosts = {&quot;entity&quot;: 0.15, &quot;module&quot;: 0.10, &quot;suite&quot;: 0.05, &quot;platform&quot;: 0.0}

        results: List[Dict[str, Any]] = []
        for level in levels:
            rows = await self._search_level(
                level, query_embedding, tenant_id, suite_id, module_id, k_per_level[level]
            )
            for r in rows:
                r[&quot;adjusted_score&quot;] = float(r[&quot;similarity_score&quot;]) + boosts.get(level, 0.0)
                r[&quot;level&quot;] = level
            results.extend(rows)

        # Sort by adjusted score and return
        results.sort(key=lambda x: x[&quot;adjusted_score&quot;], reverse=True)
        return results

    async def _search_level(
        self,
        level: str,
        embedding: List[float],
        tenant_id: str,
        suite_id: str,
        module_id: str,
        k: int
    ) -&gt; List[Dict[str, Any]]:
        filters = []
        params = [embedding]

        if level == &quot;entity&quot;:
            filters.append(&quot;d.tenant_id = $2&quot;)
            params.append(tenant_id)
            if suite_id:
                filters.append(&quot;d.suite_id = $3&quot;)
                params.append(suite_id)
            if module_id:
                filters.append(&quot;(d.module_id = $4 OR d.module_id IS NULL)&quot;)
                params.append(module_id)
        elif level == &quot;module&quot;:
            filters.append(&quot;d.level = 'module'&quot;)
            filters.append(&quot;d.suite_id = $2&quot;)
            filters.append(&quot;d.module_id = $3&quot;)
            params.extend([suite_id, module_id])
        elif level == &quot;suite&quot;:
            filters.append(&quot;d.level = 'suite'&quot;)
            filters.append(&quot;d.suite_id = $2&quot;)
            params.append(suite_id)
        else:  # platform
            filters.append(&quot;d.level = 'platform'&quot;)
            # no extra params

        # Build dynamic WHERE with defaults
        where_clause = &quot; AND &quot;.join(filters) if filters else &quot;TRUE&quot;

        query = f&quot;&quot;&quot;
            SELECT
                c.id as chunk_id,
                d.id as document_id,
                d.title,
                d.level,
                d.suite_id,
                d.module_id,
                d.tenant_id,
                d.source_uri,
                c.content,
                c.meta,
                1 - (c.embedding &lt;=&gt; $1::vector) AS similarity_score
            FROM rag.chunks c
            JOIN rag.documents d ON d.id = c.document_id
            WHERE {where_clause}
            ORDER BY c.embedding &lt;=&gt; $1::vector
            LIMIT {k}
        &quot;&quot;&quot;
        rows = await self.db.fetch(query, *params)
        return [dict(r) for r in rows]
</code></pre>
<hr />
<h2 id="4-rag-management-ui-from-fedtransform">4. RAG Management UI (From FedTransform)</h2>
<h3 id="41-capabilities-to-extract">4.1 Capabilities to Extract</h3>
<p><strong>From FedTransform backend:</strong>
- ✅ <code>oracle_docs_crawler.py</code> - URL crawling with depth control
- ✅ <code>embedding_service.py</code> - Document embedding generation
- ✅ <code>background_embedding_service.py</code> - Async batch processing
- ✅ <code>content_chunker.py</code> - Intelligent text chunking
- ✅ <code>progress_tracker.py</code> - Ingestion progress tracking</p>
<h3 id="42-new-rag-management-service">4.2 New RAG Management Service</h3>
<p><strong>Location:</strong> <code>cortx-platform/services/rag_manager/</code></p>
<p><strong>Purpose:</strong> Centralized UI and API for managing all 4 levels of knowledge</p>
<p><strong>Features:</strong></p>
<pre><code>RAG Management Dashboard:
├── Platform Knowledge
│   ├── Upload documents (PDF, DOCX, TXT, MD)
│   ├── Crawl URLs (with depth control)
│   ├── Import API documentation (OpenAPI specs)
│   └── View/search/delete embeddings
├── Suite Knowledge (per suite)
│   ├── Same capabilities as Platform
│   └── Suite admins can manage
├── Module Knowledge (per module)
│   ├── Same capabilities as Platform
│   └── Module owners can manage
└── Entity Knowledge (per tenant)
    ├── Same capabilities as Platform
    ├── Tenant-isolated (RLS enforced)
    └── Tenant admins can manage
</code></pre>
<p><strong>API Endpoints:</strong></p>
<pre><code class="language-python"># RAG Management API
POST   /v1/rag/ingest                 # Ingest document/URL
GET    /v1/rag/knowledge               # List knowledge base
DELETE /v1/rag/knowledge/{id}          # Delete knowledge
POST   /v1/rag/search                  # Search knowledge base
GET    /v1/rag/progress/{job_id}       # Check ingestion progress

# Level-specific endpoints
POST   /v1/rag/platform/ingest
POST   /v1/rag/suites/{suite_id}/ingest
POST   /v1/rag/modules/{module_id}/ingest
POST   /v1/rag/tenants/{tenant_id}/ingest
</code></pre>
<h3 id="43-ui-mockup">4.3 UI Mockup</h3>
<pre><code class="language-typescript">// RAG Management Dashboard (Next.js)
export default function RAGManagementPage() {
  return (
    &lt;DashboardLayout&gt;
      &lt;Tabs&gt;
        &lt;Tab label=&quot;Platform Knowledge&quot;&gt;
          &lt;KnowledgeIngestionForm level=&quot;platform&quot; /&gt;
          &lt;KnowledgeTable
            data={platformKnowledge}
            onDelete={handleDelete}
          /&gt;
        &lt;/Tab&gt;

        &lt;Tab label=&quot;Suite Knowledge&quot;&gt;
          &lt;SuiteSelector onChange={setSuite} /&gt;
          &lt;KnowledgeIngestionForm
            level=&quot;suite&quot;
            suiteId={selectedSuite}
          /&gt;
          &lt;KnowledgeTable
            data={suiteKnowledge}
            onDelete={handleDelete}
          /&gt;
        &lt;/Tab&gt;

        &lt;Tab label=&quot;Module Knowledge&quot;&gt;
          &lt;ModuleSelector onChange={setModule} /&gt;
          &lt;KnowledgeIngestionForm
            level=&quot;module&quot;
            moduleId={selectedModule}
          /&gt;
          &lt;KnowledgeTable
            data={moduleKnowledge}
            onDelete={handleDelete}
          /&gt;
        &lt;/Tab&gt;

        &lt;Tab label=&quot;My Organization&quot;&gt;
          &lt;KnowledgeIngestionForm
            level=&quot;entity&quot;
            tenantId={currentTenantId}
          /&gt;
          &lt;KnowledgeTable
            data={entityKnowledge}
            onDelete={handleDelete}
          /&gt;
        &lt;/Tab&gt;
      &lt;/Tabs&gt;
    &lt;/DashboardLayout&gt;
  );
}

// Ingestion Form Component
function KnowledgeIngestionForm({ level, suiteId, moduleId, tenantId }) {
  return (
    &lt;Card&gt;
      &lt;Tabs&gt;
        &lt;Tab label=&quot;Upload Document&quot;&gt;
          &lt;FileUpload
            accept=&quot;.pdf,.docx,.txt,.md&quot;
            onUpload={handleUpload}
          /&gt;
        &lt;/Tab&gt;

        &lt;Tab label=&quot;Crawl URL&quot;&gt;
          &lt;URLCrawlerForm
            onSubmit={handleCrawl}
            options={{
              maxDepth: 3,
              maxPages: 100,
              excludePatterns: []
            }}
          /&gt;
        &lt;/Tab&gt;

        &lt;Tab label=&quot;Import API Docs&quot;&gt;
          &lt;OpenAPIImporter onImport={handleAPIImport} /&gt;
        &lt;/Tab&gt;
      &lt;/Tabs&gt;

      &lt;IngestionProgress jobId={currentJobId} /&gt;
    &lt;/Card&gt;
  );
}
</code></pre>
<hr />
<h2 id="5-ocr-service-port-8137">5. OCR Service (Port 8137)</h2>
<h3 id="51-service-purpose">5.1 Service Purpose</h3>
<p>Extract structured data from documents for all modules:
- <strong>PropVerify</strong>: Title documents, deeds, liens
- <strong>FedTransform</strong>: Legacy system reports, bank statements
- <strong>ClaimsVerify</strong> (MedSuite): Healthcare claims, EOBs
- <strong>Any module</strong>: PDF/image document processing</p>
<h3 id="52-architecture">5.2 Architecture</h3>
<p><strong>Technology Stack:</strong>
- Tesseract OCR (open source)
- Google Document AI (production, high-accuracy)
- PyPDF2 for text-based PDFs
- OpenCV for image preprocessing</p>
<p><strong>Capabilities:</strong></p>
<pre><code class="language-python"># services/ocr/app/main.py
from fastapi import FastAPI, UploadFile, File
from typing import Dict, Any, List

app = FastAPI(title=&quot;CORTX OCR Service&quot;, version=&quot;1.0.0&quot;)

@app.post(&quot;/v1/ocr/extract&quot;)
async def extract_text(
    file: UploadFile = File(...),
    options: Dict[str, Any] = None
) -&gt; Dict[str, Any]:
    &quot;&quot;&quot;
    Extract text from document

    Options:
    - engine: 'tesseract' | 'google_doc_ai' | 'auto'
    - language: 'eng', 'spa', etc.
    - preprocessing: enhance, denoise, deskew
    - output_format: 'text' | 'structured' | 'json'
    &quot;&quot;&quot;
    pass

@app.post(&quot;/v1/ocr/extract-structured&quot;)
async def extract_structured_data(
    file: UploadFile = File(...),
    schema: Dict[str, Any] = None
) -&gt; Dict[str, Any]:
    &quot;&quot;&quot;
    Extract structured data based on schema

    Example schema:
    {
      &quot;fields&quot;: [
        {&quot;name&quot;: &quot;property_address&quot;, &quot;type&quot;: &quot;address&quot;},
        {&quot;name&quot;: &quot;owner_name&quot;, &quot;type&quot;: &quot;person&quot;},
        {&quot;name&quot;: &quot;parcel_id&quot;, &quot;type&quot;: &quot;alphanumeric&quot;},
        {&quot;name&quot;: &quot;recording_date&quot;, &quot;type&quot;: &quot;date&quot;}
      ]
    }
    &quot;&quot;&quot;
    pass

@app.post(&quot;/v1/ocr/batch&quot;)
async def batch_extract(
    files: List[UploadFile],
    options: Dict[str, Any] = None
) -&gt; Dict[str, Any]:
    &quot;&quot;&quot;
    Batch process multiple documents
    Returns job_id for async processing
    &quot;&quot;&quot;
    pass

@app.get(&quot;/v1/ocr/jobs/{job_id}&quot;)
async def get_job_status(job_id: str):
    &quot;&quot;&quot;Check OCR job status&quot;&quot;&quot;
    pass
</code></pre>
<h3 id="53-data-linking-from-propverify">5.3 Data Linking (From PropVerify)</h3>
<p>PropVerify has advanced <code>data_linker.py</code> (35K lines) that:
- Links extracted fields to master data
- Resolves ambiguities
- Cross-references multiple documents</p>
<p><strong>Decision:</strong> Keep in PropVerify for now, extract if other modules need it.</p>
<hr />
<h2 id="6-ledger-service-port-8136">6. Ledger Service (Port 8136)</h2>
<h3 id="61-service-purpose">6.1 Service Purpose</h3>
<p>Provide immutable audit trails for compliance-critical operations:
- <strong>PropVerify</strong>: Title chain verification history
- <strong>FedReconcile</strong>: GTAS submission audit trail
- <strong>ClaimsVerify</strong>: Healthcare claims processing trail
- <strong>Any module</strong>: Tamper-proof audit logs</p>
<h3 id="62-architecture">6.2 Architecture</h3>
<p><strong>Technology:</strong> Permissioned blockchain (Hyperledger Fabric or PostgreSQL with cryptographic hashing)</p>
<p><strong>MVP Approach (PostgreSQL-based):</strong></p>
<pre><code class="language-python"># services/ledger/app/main.py
from fastapi import FastAPI, Depends
from typing import Dict, Any, List
import hashlib
import json
from datetime import datetime

app = FastAPI(title=&quot;CORTX Ledger Service&quot;, version=&quot;1.0.0&quot;)

@app.post(&quot;/v1/ledger/append&quot;)
async def append_entry(
    entry: Dict[str, Any],
    tenant_id: str,
    module_id: str,
    user_id: str
) -&gt; Dict[str, Any]:
    &quot;&quot;&quot;
    Append immutable entry to ledger

    Entry structure:
    {
      &quot;event_type&quot;: &quot;title_verification_completed&quot;,
      &quot;entity_id&quot;: &quot;property_123&quot;,
      &quot;entity_type&quot;: &quot;property&quot;,
      &quot;data_hash&quot;: &quot;sha256_of_data&quot;,
      &quot;metadata&quot;: {...},
      &quot;timestamp&quot;: &quot;2025-10-01T12:00:00Z&quot;
    }

    Returns:
    {
      &quot;ledger_entry_id&quot;: &quot;uuid&quot;,
      &quot;block_hash&quot;: &quot;sha256_of_entry_+_prev_hash&quot;,
      &quot;previous_block_hash&quot;: &quot;...&quot;,
      &quot;confirmation&quot;: &quot;success&quot;
    }
    &quot;&quot;&quot;
    # Calculate hash chain
    prev_hash = await get_latest_block_hash(tenant_id)
    entry_with_prev = {**entry, &quot;previous_hash&quot;: prev_hash}
    block_hash = hashlib.sha256(
        json.dumps(entry_with_prev, sort_keys=True).encode()
    ).hexdigest()

    # Store in ledger table
    await store_ledger_entry(
        tenant_id=tenant_id,
        module_id=module_id,
        user_id=user_id,
        entry=entry,
        block_hash=block_hash,
        previous_hash=prev_hash
    )

    return {
        &quot;ledger_entry_id&quot;: &quot;...&quot;,
        &quot;block_hash&quot;: block_hash,
        &quot;previous_block_hash&quot;: prev_hash,
        &quot;confirmation&quot;: &quot;success&quot;
    }

@app.get(&quot;/v1/ledger/verify/{entry_id}&quot;)
async def verify_entry(entry_id: str) -&gt; Dict[str, Any]:
    &quot;&quot;&quot;
    Verify integrity of ledger entry
    Recalculates hash chain to ensure no tampering
    &quot;&quot;&quot;
    pass

@app.get(&quot;/v1/ledger/history&quot;)
async def get_history(
    tenant_id: str,
    entity_id: str = None,
    module_id: str = None,
    start_date: str = None,
    end_date: str = None
) -&gt; List[Dict[str, Any]]:
    &quot;&quot;&quot;
    Get ledger history for entity/tenant
    &quot;&quot;&quot;
    pass

@app.post(&quot;/v1/ledger/audit-report&quot;)
async def generate_audit_report(
    tenant_id: str,
    start_date: str,
    end_date: str,
    module_ids: List[str] = None
) -&gt; Dict[str, Any]:
    &quot;&quot;&quot;
    Generate compliance audit report
    &quot;&quot;&quot;
    pass
</code></pre>
<h3 id="63-database-schema">6.3 Database Schema</h3>
<pre><code class="language-sql">CREATE SCHEMA ledger;

CREATE TABLE ledger.blocks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id VARCHAR(100) NOT NULL,
    module_id VARCHAR(100) NOT NULL,
    block_number BIGSERIAL,
    block_hash VARCHAR(64) NOT NULL UNIQUE,  -- SHA-256
    previous_hash VARCHAR(64),

    -- Entry data
    event_type VARCHAR(100) NOT NULL,
    entity_id VARCHAR(255),
    entity_type VARCHAR(100),
    data_hash VARCHAR(64) NOT NULL,  -- Hash of actual data (stored separately)
    metadata JSONB,

    -- Audit
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    created_by VARCHAR(255) NOT NULL,

    -- Constraints
    CONSTRAINT fk_tenant FOREIGN KEY (tenant_id) REFERENCES platform.tenants(id),
    CONSTRAINT valid_hash_chain CHECK (
        (block_number = 1 AND previous_hash IS NULL) OR
        (block_number &gt; 1 AND previous_hash IS NOT NULL)
    )
);

-- Indexes
CREATE INDEX idx_blocks_tenant ON ledger.blocks(tenant_id);
CREATE INDEX idx_blocks_entity ON ledger.blocks(tenant_id, entity_id);
CREATE INDEX idx_blocks_module ON ledger.blocks(module_id);
CREATE INDEX idx_blocks_created_at ON ledger.blocks(created_at);

-- Immutability: Prevent updates/deletes
REVOKE UPDATE, DELETE ON ledger.blocks FROM PUBLIC;
</code></pre>
<hr />
<h2 id="7-implementation-roadmap">7. Implementation Roadmap</h2>
<h3 id="phase-1-foundation-weeks-1-2">Phase 1: Foundation (Weeks 1-2)</h3>
<ol>
<li>✅ Design hierarchical RAG architecture (this document)</li>
<li>⏳ Extract FedTransform RAG components</li>
<li>⏳ Create RAG Management UI scaffold</li>
<li>⏳ Set up pgvector database schema</li>
<li>⏳ Implement basic retrieval (single-level)</li>
</ol>
<h3 id="phase-2-ocr-ledger-services-weeks-3-4">Phase 2: OCR &amp; Ledger Services (Weeks 3-4)</h3>
<ol>
<li>⏳ Extract PropVerify OCR engine</li>
<li>⏳ Create OCR Service (port 8137)</li>
<li>⏳ Extract PropVerify Ledger service</li>
<li>⏳ Create Ledger Service (port 8136)</li>
<li>⏳ Integrate services with AI Broker</li>
</ol>
<h3 id="phase-3-hierarchical-retrieval-weeks-5-6">Phase 3: Hierarchical Retrieval (Weeks 5-6)</h3>
<ol>
<li>⏳ Implement 4-level retrieval logic</li>
<li>⏳ Build context scoring algorithm</li>
<li>⏳ Add smart context expansion</li>
<li>⏳ Performance optimization (caching, indexes)</li>
</ol>
<h3 id="phase-4-rag-management-ui-weeks-7-8">Phase 4: RAG Management UI (Weeks 7-8)</h3>
<ol>
<li>⏳ Build document upload interface</li>
<li>⏳ Build URL crawler interface</li>
<li>⏳ Build knowledge browsing/search</li>
<li>⏳ Implement progress tracking</li>
<li>⏳ Add level-based permissions</li>
</ol>
<h3 id="phase-5-integration-testing-weeks-9-10">Phase 5: Integration &amp; Testing (Weeks 9-10)</h3>
<ol>
<li>⏳ Integrate with all suites</li>
<li>⏳ Load initial knowledge bases</li>
<li>⏳ End-to-end testing</li>
<li>⏳ Performance tuning</li>
<li>⏳ Documentation</li>
</ol>
<hr />
<h2 id="8-migration-strategy">8. Migration Strategy</h2>
<h3 id="81-existing-rag-data">8.1 Existing RAG Data</h3>
<p><strong>FedTransform RAG data:</strong>
- Current location: FedTransform embeddings (FAISS/local)
- Migration: Export → Re-embed → Import to Module-level (FedTransform)</p>
<p><strong>FedSuite RAG data:</strong>
- Current location: <code>cortx-suites/fedsuite/embeddings/</code>
- Migration: Export → Categorize (Suite vs Module) → Import</p>
<h3 id="82-knowledge-seeding">8.2 Knowledge Seeding</h3>
<p><strong>Platform Level (Week 1):</strong>
- NIST 800-53 controls
- CORTX Platform docs
- General security best practices</p>
<p><strong>Suite Level (Week 2):</strong>
- FedSuite: OMB circulars, GTAS guide, USSGL
- CorpSuite: Real estate law basics
- MedSuite: HIPAA regulations</p>
<p><strong>Module Level (Weeks 3-4):</strong>
- FedTransform: Oracle/SAP schemas
- PropVerify: SDAT API docs
- FedReconcile: GTAS schemas</p>
<hr />
<h2 id="9-open-questions-decisions">9. Open Questions &amp; Decisions</h2>
<h3 id="91-embedding-model">9.1 Embedding Model</h3>
<p><strong>Question:</strong> Which embedding model?
- <strong>Option A:</strong> OpenAI <code>text-embedding-3-small</code> (384-dim, $0.02/1M tokens)
- <strong>Option B:</strong> Google <code>textembedding-gecko</code> (768-dim, Vertex AI pricing)
- <strong>Option C:</strong> Open source (Sentence Transformers, free, self-hosted)</p>
<p><strong>Recommendation:</strong> Start with OpenAI (fast, cheap), migrate to open source for compliance/cost.</p>
<h3 id="92-chunking-strategy">9.2 Chunking Strategy</h3>
<p><strong>Question:</strong> How to chunk documents?
- <strong>Fixed size:</strong> 512 tokens per chunk (simple)
- <strong>Semantic chunking:</strong> Split on paragraphs/sections (better context)
- <strong>Hybrid:</strong> Semantic + max size constraint</p>
<p><strong>Recommendation:</strong> Semantic chunking with 512-token max.</p>
<h3 id="93-vector-store-performance">9.3 Vector Store Performance</h3>
<p><strong>Question:</strong> Can pgvector handle this at scale?
- <strong>Concern:</strong> 1M+ embeddings across 4 levels
- <strong>Alternative:</strong> Pinecone, Weaviate, Qdrant (managed vector DBs)</p>
<p><strong>Recommendation:</strong> Start with pgvector (simpler), monitor performance, migrate if needed.</p>
<hr />
<p><strong>END OF DOCUMENT</strong></p>
<h2 id="10-environment-deployment-considerations">10. Environment &amp; Deployment Considerations</h2>
<p><strong>Environments:</strong> <code>dev</code> → <code>staging</code> → <code>prod</code> with identical topology and promotion gates.</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Dev</th>
<th>Staging</th>
<th>Prod</th>
</tr>
</thead>
<tbody>
<tr>
<td>Identity</td>
<td>In-repo OIDC + GitHub/Google</td>
<td>Same + restricted external IdP</td>
<td>Keycloak/Auth0 or hardened OIDC</td>
</tr>
<tr>
<td>AI Providers</td>
<td>Vertex + (optional) OpenAI (flagged)</td>
<td>Vertex primary</td>
<td>Vertex only (unless ATO extends)</td>
</tr>
<tr>
<td>Database</td>
<td>Cloud SQL (HA in stg/prod) + pgvector</td>
<td>Cloud SQL (HA) + pgvector</td>
<td>Cloud SQL (HA) + pgvector</td>
</tr>
<tr>
<td>Redis</td>
<td>MemoryStore basic</td>
<td>MemoryStore standard</td>
<td>MemoryStore standard</td>
</tr>
<tr>
<td>Storage</td>
<td>gcs-{svc}-dev</td>
<td>gcs-{svc}-stg</td>
<td>gcs-{svc}-prod</td>
</tr>
<tr>
<td>Secrets</td>
<td>Secret Manager (dev)</td>
<td>Secret Manager (stg)</td>
<td>Secret Manager (prod)</td>
</tr>
<tr>
<td>Network</td>
<td>Private VPC (dev subnet)</td>
<td>Isolated subnet</td>
<td>Isolated subnet + WAF hardening</td>
</tr>
<tr>
<td>Deploy</td>
<td>Auto on main merge</td>
<td>Manual approve</td>
<td>Manual approve + change record</td>
</tr>
<tr>
<td>Data</td>
<td>Synthetic</td>
<td>Sanitized prod-like</td>
<td>Live tenant data</td>
</tr>
</tbody>
</table>
<p><strong>Demo Checkpoints</strong> are aligned with this plan: (A) FedReconcile RAG demo (Week 3), (B) Ledger Evidence export (Week 6), (C) OCR→RAG pipeline (Week 8–9).</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>